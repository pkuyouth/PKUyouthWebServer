{% extends "htmlcoder/base.html" %}
{% block title %}Docs{% endblock %}
{% block style %}
	<style type="text/css">
		ul > li{font-weight: bold; font-size: 120%; padding: 15px 5px;} 
		ol > li{font-weight: normal; font-size: 100%; padding: 5px; line-height: 1.5em;} 
		ol > ul > li{font-weight: normal; font-size: 90%; padding: 5px; line-height: 1.5em;}
		blockquote{font-size: 90% ;color: grey;}
	</style>
{% endblock %}
{% block body %}
	<article>
		<h2>&gt;&#8195;使用说明</h2>
		<ul>
			<li>功能简介 —— 我该如何使用这个网站？</li>
				<ol>
					<li>用 Chrome 打开网站。</li>
					<li>下载一个 docx 模板。</li>
					<li>在模板 docx 里排版好推送文章。</li>
					<li>在首页上传排好版的 docx 文件，如果成功，便可以在下方看到服务器自动渲染好推送预览。</li>
					<li>打开微信公众号后台的素材管理页，点击新建素材。</li>
					<li>回到网站首页，<b>Ctrl + A</b> 全选推送预览，<b>Ctrl + C</b> 复制。</li>
					<li>在公号素材编辑框中直接 <b>Ctrl + V</b> 粘贴，可以看到推送已经上传。</li>
					<li>检查格式是否有错，然后手动修改。</li>
					<li>向手机发送预览。</li>
					<li>Done !</li>
				</ol>
			<li>工作原理 —— 程序怎样帮我干活？</li>
				<ol>
					<li>docx 文件实际上是 zip + xml 文件。</li>
					<li>服务器提供了一个 py 脚本，用于解析 docx 中的 xml 文件，再依据其解读到的信息，按一定规则将其重新编码为 html 文件。</li>
					<li>服务器同时还会为图片提供临时链接，允许微信服务器通过外网访问和下载 docx 中的图片，为其提供微信私有的临时素材链接，从而实现图片上传。</li>
					<li>Chrome 允许直接复制 html 标签，而公号素材编辑器允许直接粘贴html标签，因此可以通过剪贴板直接移动。事实上 xiumi 用的就是这个原理。不过浏览器具体如何去实现的，这一点小哥还没有搞懂...</li>
					<li>推荐 Chrome（主要是小哥只拿这个试过orz...），据说其他一些浏览器（比如 Firefox、360 等）也支持这种复制，可以尝试一下，不过至少要保证两端使用的浏览器相同，跨浏览器复制粘贴（当然我没试过...）可能会导致乱码（吧）。</li>
					<p>———————————————— 以上是废话 ————————————————</p>
					<li>你要做的事情是，你需要告诉程序，docx 里的哪些文字，应该属于推送中的哪些部分，然后剩下就交给程序做吧～</li>
				</ol>
			<li>参数说明 —— 我可以定制怎样的排版规则？</li>
				<ol>
					<li><b>无记者信息</b> —— 如果文前不需要注明记者信息，那么勾选该项，docx 文前的记者信息将被忽略。</li>
					<li><b>无参考文献</b> —— 如果文末不需要注明参考文献，那么勾选该项，之后，文后所有（本应被视为参考文献）的<b>左对齐</b>的段落将被视为文末注释（灰色 14px 两端对齐）。也可以没有这样的段落，这相当于文末没有注释。</li>
					<li><b>统计字数</b> —— 勾选该项，则文前的统计框中会计算字数。（注：统计范围为所有<b>正文内容</b>，不包含图注/标题/...）</li>
					<li><b>统计图片</b> —— 勾选该项，则文前的统计框中会计算图片数量。</li>
					<blockquote><p>注：默认勾选<b>统计字数</b>。可以两项都不勾选，那么程序将不输出统计框。字数和图片数只能统计其一，如果两项都勾选，文件将无法上传。</p></blockquote>
					<li><b>生成顶/底图</b> —— 也称为<b>完整渲染</b>，勾选该项，则 docx 文前/文后的图片（如果存在）将被视为顶/底图渲染出来。因为通常两图会在公号后台手动添加，因此该项默认为不勾选。这时 docx 文前/文后的图片被忽略。</li>
					<blockquote><p>注：若勾选该项，粘贴到公众号后，需手动删除最下方（底图之下）的空行。</p></blockquote>
				</ol>
			<li>模板规则 —— 我应该怎样和程序交流？</li>
				<ol>
					<li><b>[写在前面]</b> 程序按照 docx 中的段落（每一段以一个换行符结束）为单元进行解析。</li>
					<li><b>[写在前面]</b> 所有 docx 中的所有<b>空行</b>均会被忽略，不影响实际排版。</li>
					<li><b>[保留字符]</b> 以 <b>@</b> 开头，为注释段，程序会自动忽略这一段的内容。</li>
					<li><b>[保留字符]</b> 以 <b>%xxx%</b> （xxx为变量名，大小写不敏感）开头（其后的内容会被忽略），为 Boolean (0/1) 型变量名，用于动态控制程序的运行规则。以下列出可接收的参数：</li>
						<ul><br>
							<li><b>%headEnd% [控制变量]</b> 推送中分割线以上的内容（记者信息）结束。</li>
							<li><b>%bodyEnd% [控制变量]</b> 正文结束。</li>
							<li><b>%tailEnd% [控制变量]</b> 正文后的参考文献、尾注内容结束。</li>
						</ul><br>
					<li><b>[写在中间]</b> 程序会分区域，根据当前的<b>段落样式</b>理解该段的内容。</li>
					<li><b>[段落样式]</b><b> %headEnd% </b>前：</li>
						<ul><br>
							<li>所有的<b>非加粗</b>正文内容将视为记者信息，如果你要声明这个是标题（记者信息/摄影/...），则将该段<b>加粗</b>。</li>
							<blockquote><p>注：不解析顶图，该区域内的图片段会被忽略。</p></blockquote>
						</ul><br>
					<li><b>[段落样式]</b><b> %headEnd% </b>与<b> %bodyEnd% </b>之间：</li>
						<ul><br>
							<li>如果该段存在<b>图片</b>，则视为图片行，其他内容忽略，图片应当使用默认的<b>嵌入型</b>版式，并且<b>单独成行</b>。</li>
							<li>标题有两种声明方法：
								<br><b>&#8195;1、常规方法：</b><b>一号标题</b>（20px 黑色加粗）声明为<b>标题</b>样式，<b>二号标题</b>（15px 红色加粗）声明为<b>副标题</b>样式。这种方法可支持两种标题的声明。
								<br><b>&#8195;2、快捷方法（推荐）：</b>将该段样式设为<b> 加粗 + 居中 </b>，则视为<b>一号标题</b>。
							</li>
							<li>如果样式为<b> 非加粗 + 居中 </b>，则视为<b>图注</b>。</li>
							<li>如果该段样式为<b>右对齐</b>，则视为右对齐的<b>引文注释</b>（——xxx）。</li>
							<li>其他<b>非右对齐/居中对齐、非加粗、非标题/副标题</b>样式的段落，均视为<b>正文段</b>。</li>
							<blockquote><p>注：以上按照解析的优先级顺序排列。</p></blockquote>
						</ul><Br>
					<li><b>[段落样式]</b><b> %bodyEnd% </b>与<b> %tailEnd% </b>之间：</li>
						<ul><br>
							<li>首先，所有<b>右对齐</b>段落视为<b>尾注信息</b>（微信编辑/图片来源/...）。</li> 
							<li>对于<b>非右对齐</b>段落，如果声明为有参考文献，则统一视为<b>参考文献</b>，同理，如果你想声明标题（参考文献/参考资料/...），则将该段<b>加粗</b>；如果未声明参考文献，则统一视为灰色的左对齐<b>小字注释</b>（这种注释貌似不常见）。
							</li>
							<blockquote><p>注：不解析底图，该区域内的图片段会被忽略。</p></blockquote>
						</ul><br>
					<li><b>[写在最后]</b> 想要用得顺手，你需要知道 Word 有这些快捷键：</li>
						<ul><br>
							<li><b>Ctrl + B </b>加粗</li>
							<li><b>Ctrl + E </b>居中</li>
							<li><b>Ctrl + J </b>两端对齐</li>
							<li><b>Ctrl + R </b>右对齐</li>
							<li><b>Ctrl + L </b>左对齐</li>
						</ul><br>
				</ol>
			<li>细节剖析 —— 程序还有多少不为人知的便捷？</li>
				<ol>
					<li>可以在各段落间随意添加空行（也可以不加），不会影响最终的排版效果。</li>
					<li>程序会自动将记者信息、文末微信编辑中的<b>空格/竖线</b>转为<b>全角</b>，连续空格合并识别为一个空格（其实连续竖线也是这样的，不过考虑到应该不会出现连续竖线...）。如果已经是全角字符，则保留，不作处理。</li>
					<blockquote><p>注：即使程序可以自动转全角，作为一个熟练的美编，平时还是要养成使用全角符号的习惯 orz...</p></blockquote>
					<li>不像图注，任何图片都不需要额外设置对其方式（比如居中），只需要单独成行，程序就可以正确解析。事实上程序并不管图片怎样对齐，所以你设为右对齐也是可以的（虽然可能会比较难看x）</li>
					<blockquote><p>注：为了防止定位错误，一定要将图片设置为默认的<b>嵌入型</b>版式</p></blockquote>
					<li>图片与图注相邻处不空行，这个很显然。事实上，图片与图片相邻时，也不会空行，因此不需要手动调整。</li>
				</ol>
			<li>注意事项 —— 我应该怎样避免遇到错误？</li>
				<ol>
					<li>小哥做网页水平有限，服务器也比较低配... 所以最好的策略是不要乱搞orz... 比如不要尝试网往服务器上传些奇怪的东西嗯...</li>
					<li>只要按照以上规则排版 docx ，理论上是不会出错的嗯（然而...）。</li>
					<li>因为 docx 的版本不唯一，使用的 xml 规则不统一，小哥目前只解析了一个版本（具体哪个版本我也搞不懂...），如果你使用其他版本的 docx 可能会导致程序运行失败（应该会显示 NoneType ...）。所以，最好的策略是直接下载首页的模板，在小哥提供的 docx 文件中排版，然后<b>直接保存</b>，不要选择另存为，或是改用其他的 xml 规则保存，这样就不会遇到 docx 版本不正确的问题。</li>
					<li>目前工具还在调试阶段，出错可以说是不可避免的... 如果如果出错，服务器将会捕获错误，并将错误描述发送回来，然后你把这个框里的内容给小哥看一下就好啦～</li>
				</ol>
		</ul>
	</article>
{% endblock %}